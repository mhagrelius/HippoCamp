---
name: Memory CRUD Operations
status: open
created: 2025-09-05T00:41:49Z
updated: 2025-09-05T00:50:45Z
github: https://github.com/mhagrelius/HippoCamp/issues/10
depends_on: ["003"]
parallel: true
conflicts_with: []
---

# Task 004: Memory CRUD Operations

## Description

Implement comprehensive create, read, update, delete operations for memory entities in the Memory Store API. This task focuses on building robust CRUD operations with proper validation, error handling, and batch operation support to enable efficient memory management for AI agents.

## Acceptance Criteria

### Core CRUD Operations
- [ ] **Create**: Add new memory entries with embeddings and metadata
- [ ] **Read**: Retrieve individual memories by ID and lists by project
- [ ] **Update**: Modify existing memory content, metadata, and deprecation status
- [ ] **Delete**: Soft delete with retention period (no permanent deletion)

### Validation & Error Handling
- [ ] Input validation for all memory fields (content, embeddings, metadata)
- [ ] Proper HTTP status codes and error responses
- [ ] Validation of embedding dimensions and format
- [ ] Metadata schema validation for required fields

### Batch Operations
- [ ] Batch create operations for multiple memories
- [ ] Batch update operations with transaction support
- [ ] Bulk deprecation of memories by criteria

### API Endpoints
- [ ] `POST /api/memories` - Create single memory
- [ ] `POST /api/memories/batch` - Create multiple memories
- [ ] `GET /api/memories/{id}` - Get memory by ID
- [ ] `PUT /api/memories/{id}` - Update existing memory
- [ ] `DELETE /api/memories/{id}` - Soft delete memory
- [ ] `GET /api/projects/{projectId}/memories` - Get project memories

## Technical Details

### Data Validation
```csharp
// Input validation rules
- Content: Required, max 10KB
- Embedding: Required, consistent dimensions
- ProjectId: Required, valid project reference
- MemoryType: Required, valid enum value
- Metadata: Optional, valid JSON structure
```

### Error Response Format
```csharp
public class ApiErrorResponse
{
    public string Error { get; set; }
    public string Details { get; set; }
    public Dictionary<string, string[]> ValidationErrors { get; set; }
}
```

### Batch Operation Constraints
- Maximum 100 memories per batch operation
- Transaction rollback on any validation failure
- Progress reporting for large batch operations

### Soft Delete Implementation
- Set `IsDeleted` flag instead of physical deletion
- Retention period configuration (default 30 days)
- Background cleanup job for expired deleted memories

## Dependencies

### Technical Dependencies
- **003 - Core Data Model**: Memory entity and DbContext must be implemented
- **Entity Framework Core**: For data persistence and transactions
- **ASP.NET Core**: For API controller implementation

### External Dependencies
- PostgreSQL database instance with proper schema
- Validation libraries for input sanitization
- Logging framework for operation tracking

## Effort Estimate

**Size**: Medium (M)
**Estimated Hours**: 16-20 hours
**Complexity**: Medium - Standard CRUD with some complexity in batch operations

### Breakdown
- Core CRUD operations: 8 hours
- Validation and error handling: 4 hours
- Batch operations: 6 hours
- Testing and documentation: 2 hours

## Definition of Done

### Code Quality
- [ ] All CRUD operations implemented with proper error handling
- [ ] Input validation for all API endpoints
- [ ] Comprehensive unit tests for all operations
- [ ] Integration tests for API endpoints

### Performance
- [ ] Single memory operations complete in <100ms
- [ ] Batch operations handle 100 memories efficiently
- [ ] Proper transaction management for data consistency

### Documentation
- [ ] API endpoint documentation with examples
- [ ] Error code reference documentation
- [ ] Batch operation usage guidelines

### Security
- [ ] Input sanitization to prevent injection attacks
- [ ] Proper authorization checks for memory access
- [ ] Audit logging for all CRUD operations

### Testing Coverage
- [ ] Unit tests for all service methods (>90% coverage)
- [ ] Integration tests for all API endpoints
- [ ] Error scenario testing (invalid input, missing data)
- [ ] Batch operation testing with edge cases
